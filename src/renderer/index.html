<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; connect-src blob: *; script-src 'self' 'unsafe-eval' 'unsafe-inline' *; worker-src 'self' blob:; style-src 'self' 'unsafe-inline' *; font-src 'self' data: *; img-src 'self' data: file: * blob:; frame-src * file:" />
    <title>Cherry Studio</title>

    <style>
      html,
      body {
        margin: 0;
      }

      #spinner {
        position: fixed;
        width: 100vw;
        height: 100vh;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        display: flex;
      }

      #spinner img {
        width: 100px;
        border-radius: 50px;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>
    <div id="spinner">
      <img src="/src/assets/images/logo.png" />
    </div>
    <script>
      console.time('init')
      // Define global objects for Node.js modules (safe version)
      try {
        if (typeof process === 'undefined') {
          Object.defineProperty(window, 'process', {
            value: {
              env: {},
              platform: 'browser',
              arch: 'x64',
              version: 'v18.0.0',
              versions: { node: '18.0.0' }
            },
            writable: false,
            configurable: true
          })
        }
      } catch (e) {
        // Ignore if process is already defined
      }

      try {
        if (typeof global === 'undefined') {
          Object.defineProperty(window, 'global', {
            value: window,
            writable: false,
            configurable: true
          })
        }
      } catch (e) {
        // Ignore if global is already defined
      }

      try {
        if (typeof Buffer === 'undefined') {
          Object.defineProperty(window, 'Buffer', {
            value: {
              from: function (data) {
                return new Uint8Array(data)
              },
              isBuffer: function () {
                return false
              }
            },
            writable: false,
            configurable: true
          })
        }
      } catch (e) {
        // Ignore if Buffer is already defined
      }
    </script>
    <script type="module" src="/src/init.ts"></script>
    <script type="module" src="/src/entryPoint.tsx"></script>
  </body>
</html>
